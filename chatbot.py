import random
import re

class Chatbot:
    def __init__(self):
        self.greetings = [
            "ูุฑุญุจุงู! ููู ูููููู ูุณุงุนุฏุชู ุงููููุ",
            "ุฃููุงู ูุณููุงู! ุฃูุง ููุง ููุฅุฌุงุจุฉ ุนูู ุงุณุชูุณุงุฑุงุชู ุงููุงููููุฉ.",
            "ูุฑุญุจุงู ุจู! ููู ูููููู ูุณุงุนุฏุชู ูู ููุถูุนู ุงููุงููููุ"
        ]

        self.goodbyes = [
            "ุดูุฑุงู ูุชูุงุตูู! ุฅุฐุง ููุช ุจุญุงุฌุฉ ููุณุงุนุฏุฉ ุฃุฎุฑู ูู ุงููุณุชูุจูุ ูุง ุชุชุฑุฏุฏ ูู ุงูุนูุฏุฉ.",
            "ุฅูู ุงูููุงุก! ุฅุฐุง ููุช ุจุญุงุฌุฉ ููุฒูุฏ ูู ุงูุงุณุชุดุงุฑุงุช ุงููุงููููุฉุ ุฃูุง ููุง ุฏุงุฆูุงู.",
            "ุชูููุงุชู ูู ุจุงูุชููููุ ููุง ุชุชุฑุฏุฏ ูู ุทูุจ ุงููุณุงุนุฏุฉ ูุณุชูุจูุงู!"
        ]

        self.topics = {
            "ุฅุฌุงุฒุฉ ุณูููุฉ": {
                "keywords": ["ุฅุฌุงุฒุฉ", "ุงูุฅุฌุงุฒุฉ", "ุนุทูุฉ", "ุนุทูุชู", "ุฅุฌุงุฒุชู"],
                "follow_ups": [
                    ("ูู ุชู ุชุญุฏูุฏ ุชูููุช ุงูุฅุฌุงุฒุฉ ูุณุจูุงูุ", "ุฅุฐุง ุชู ุชุญุฏูุฏ ุชูููุช ูุณุจููุงุ ูุฌุจ ุงุญุชุฑุงูู ูู ูุจู ุงูุทุฑููู ูุง ูู ูุญุตู ุงุชูุงู ุฌุฏูุฏ."),
                    ("ูู ุชู ุฑูุถ ุทูุจู ููุฅุฌุงุฒุฉุ", "ูู ุญุงู ุงูุฑูุถ ุฏูู ุณุจุจ ูุดุฑูุนุ ูุญู ูู ุชูุฏูู ุดููู ููุฒุงุฑุฉ ุงูุนูู."),
                    ("ูู ุชุฌุงูุฒุช ุนุฏุฏ ุงูุฃูุงู ุงููุณููุญุฉ ุจุงูุฅุฌุงุฒุฉุ", "ุงูุฅุฌุงุฒุฉ ุงูุณูููุฉ ูู ุงูุฃุฑุฏู ุนุงุฏุฉ ุชููู 14-21 ูููุงู ุญุณุจ ูุฏุฉ ุงูุฎุฏูุฉ."),
                    ("ูู ููุฌุฏ ุชุนููุถ ูุงูู ุจุฏู ุงูุฅุฌุงุฒุฉุ", "ุฅุฐุง ูู ุชุชููู ูู ุฃุฎุฐ ุงูุฅุฌุงุฒุฉุ ููููู ุงููุทุงูุจุฉ ุจุชุนููุถ ูุงูู ุนููุง.")
                ]
            },
            "ุทูุงู": {
                "keywords": ["ุทูุงู", "ูุทููุฉ", "ุชุทููู", "ุงูุทูุงู"],
                "follow_ups": [
                    ("ูู ููุงู ุฃุทูุงู ูุดููููู ูู ุงููุถูุฉุ", "ูุฌูุฏ ุฃุทูุงู ูุฌุนู ุงูุญุถุงูุฉ ูุงููููุฉ ุฌุฒุก ุฃุณุงุณู ูู ุงูุทูุงู."),
                    ("ูู ุชู ุงูุงุชูุงู ุนูู ุงููููุฉุ", "ูููู ุชุญุฏูุฏ ุงููููุฉ ูู ุงููุญููุฉ ุงูุดุฑุนูุฉ ุญุณุจ ุฏุฎู ุงูุฃุจ ูุงุญุชูุงุฌุงุช ุงูุทูู."),
                    ("ูู ุชุฑุบุจ ูู ูุนุฑูุฉ ุญูููู ูู ุญุงู ุงูุทูุงูุ", "ููู ูู ุงูุฒูุฌูู ุญููู ูุงููููุฉ ุชุฎุชูู ุญุณุจ ููุน ุงูุทูุงู ูุงูุงุชูุงู."),
                    ("ูู ุชู ุงูุงุชูุงู ุนูู ุชูุณูู ุงูููุชููุงุชุ", "ูู ุญุงู ุนุฏู ุงูุงุชูุงูุ ููุตู ุงููุงุถู ุจูุงุกู ุนูู ุงููุณุชูุฏุงุช ูุงููุณุงููุงุช."),
                    ("ูู ุฃุญุฏ ุงูุทุฑููู ูุฑูุถ ุงูุทูุงูุ", "ุงูุทูุงู ูู ุญุงู ุงููุฒุงุน ูุชุทูุจ ุฅุซุจุงุช ุงูุถุฑุฑ ุฃู ุงูุดูุงู.")
                ]
            },
            "ุญุถุงูุฉ": {
                "keywords": ["ุญุถุงูุฉ", "ุงูุญุถุงูุฉ", "ุญุงุถูุฉ", "ุงูุญุงุถูุฉ"],
                "follow_ups": [
                    ("ูู ุนูุฑ ุงูุทูู ุฏูู 15 ุณูุฉุ", "ุงูุฃู ุนุงุฏุฉ ุฃุญู ุจุงูุญุถุงูุฉ ุญุชู ูุจูุบ ุงูุทูู 15 ุณูุฉ ูู ุงููุงููู ุงูุฃุฑุฏูู."),
                    ("ูู ููุฌุฏ ูุฒุงุน ุนูู ููุงู ุงูุญุถุงูุฉุ", "ูููู ูููุญููุฉ ุชุญุฏูุฏ ุงูููุงู ุงูููุงุณุจ ุจูุงุกู ุนูู ูุตูุญุฉ ุงูุทูู."),
                    ("ูู ุฃุญุฏ ุงูุฃุจููู ุบูุฑ ูุคูู ููุญุถุงูุฉุ", "ูููู ููุฏุงู ุงูุญุถุงูุฉ ุฅุฐุง ุซุจุช ุนุฏู ุงูุฃูููุฉ ุฃู ุณูุก ุงููุนุงููุฉ."),
                    ("ูู ููุงู ุทูุจ ูุฑุคูุฉ ุงูุทููุ", "ูุชู ุชุฑุชูุจ ููุงุนูุฏ ุงูุฒูุงุฑุฉ ูู ุฎูุงู ุงููุญููุฉ ุงูุดุฑุนูุฉ.")
                ]
            },
            "ุนูู": {
                "keywords": ["ุนูู", "ูุธููุฉ", "ุดุบู", "ุงููุธููุฉ", "ุงูุนุงูู", "ุงูุนูู"],
                "follow_ups": [
                    ("ูู ุชู ูุตูู ูู ุงูุนููุ", "ุฅุฐุง ูุงู ุงููุตู ุชุนุณูููุงุ ููููู ุงููุทุงูุจุฉ ุจุชุนููุถ."),
                    ("ูู ููุงู ุนูุฏ ููุชูุจ ุจููู ูุจูู ุงูุดุฑูุฉุ", "ุงูุนูุฏ ุถุฑูุฑู ูุฅุซุจุงุช ุงูุญููู ูุงููุงุฌุจุงุช."),
                    ("ูู ุชุนูู ุฃูุซุฑ ูู ุงูุณุงุนุงุช ุงููุงููููุฉุ", "ุงูุนูู ุงูุฅุถุงูู ูู ุฃุฌุฑ ุฅุถุงูู ุญุณุจ ูุงููู ุงูุนูู."),
                    ("ูู ุชุณุชูู ุฑุงุชุจู ุจุงูุชุธุงูุ", "ุนุฏู ุฏูุน ุงูุฃุฌุฑ ูุนุชุจุฑ ูุฎุงููุฉ ููุญู ูู ุงูุดููู.")
                ]
            },
            "ุนูุฏ ุฅูุฌุงุฑ": {
                "keywords": ["ุฅูุฌุงุฑ", "ุนูุฏ ุงูุฅูุฌุงุฑ", "ุงูุนูุงุฑ", "ุงููุณุชุฃุฌุฑ", "ุงููุคุฌุฑ", "ุงูุฅุฎูุงุก"],
                "follow_ups": [
                    ("ูู ุงูุนูุฏ ูุณุฌู ูุฏู ุงูุจูุฏูุฉุ", "ุชุณุฌูู ุงูุนูุฏ ูุถูู ุงูุญูุงูุฉ ุงููุงููููุฉ ููุทุฑููู."),
                    ("ูู ุชู ุฅุฎุทุงุฑู ุจุงูุฅุฎูุงุกุ", "ูุฌุจ ุฃู ูุชู ุงูุฅุฎุทุงุฑ ุจุงูุฅุฎูุงุก ููู ุฅุดุนุงุฑ ุฑุณูู ูุฎูุงู ูุฏุฉ ูุญุฏุฏุฉ."),
                    ("ูู ููุงู ุฎูุงู ุนูู ูููุฉ ุงูุฅูุฌุงุฑุ", "ูููู ููุทุฑููู ุงููุฌูุก ูููุญููุฉ ูุญู ุงููุฒุงุน."),
                    ("ูู ููุฌุฏ ุชูููุงุช ูู ุงูุนูุงุฑุ", "ุนุงุฏุฉู ูุชุญูู ุงููุคุฌุฑ ุงูุฅุตูุงุญุงุช ุงูุฃุณุงุณูุฉ ุฅูุง ุฅุฐุง ูุฑุฏ ุฎูุงู ุฐูู ูู ุงูุนูุฏ.")
                ]
            }
        }

        self.user_topic = None
        self.depth = 0
        self.waiting_yes_no = False

    def get_response(self, user_input):
        user_input = user_input.strip()

        if re.search(r"(ูุฑุญุจุง|ุฃููุง|ุตุจุงุญ ุงูุฎูุฑ|ูุณุงุก ุงูุฎูุฑ)", user_input):
            return random.choice(self.greetings)
        if re.search(r"(ุฎุฑูุฌ|ุดูุฑุง|ูุฏุงุน|ุฅูู ุงูููุงุก|ูุน ุงูุณูุงูุฉ|ุจุงู)", user_input):
            return random.choice(self.goodbyes)

        # Step 1: Check if we're waiting for a yes/no
        if self.waiting_yes_no:
            if user_input in ["ูุนู", "ุงููู", "ุงุฌู", "ุฃุฌู", "ุงู"]:
                self.depth += 1
                return self.ask_and_answer()
            elif user_input in ["ูุง", "ูู"]:
                self.depth += 1
                return self.ask_and_answer()
            else:
                return random.choice([
                    "ูู ููููู ุชูุถูุญ ุงุณุชูุณุงุฑู ุจุดูู ุฃูุจุฑ ุญุชู ุฃุชููู ูู ูุณุงุนุฏุชูุ",
                    "๐ ูู ููููู ุฃู ุชุฎุจุฑูู ุงููุฒูุฏ ุนู ุญุงูุชูุ",
                    "๐ค ูู ุฃููู ุชูุงููุงุ ูู ููููู ุฅุนุงุฏุฉ ุตูุงุบุฉ ุงูุณุคุงูุ",
                    "๐ ุงูุฑุฌุงุก ุชูุฏูู ูุฒูุฏ ูู ุงูุชูุงุตูู ููุชููู ูู ุงููุชุงุจุนุฉ.",
                    "โ ูุง ูู ุงููุดููุฉ ุงููุงููููุฉ ุงูุชู ุชูุงุฌููุง ุชุญุฏูุฏูุงุ"
                ])


        # Step 2: Detect topic using keywordsfor topic_name, topic_data in self.topics.items():
        for topic_name, topic_data in self.topics.items():
            for kw in topic_data["keywords"]:
                if re.search(kw, user_input):
                    self.user_topic = topic_name
                    self.depth = 0
                    return self.ask_and_answer()
                    
        # Step 3: If topic is already active, continue
        if self.user_topic:
            self.waiting_yes_no = True
            return f"ูู ููููู ุชุฃููุฏ ุฃู ููู ุงูุฃูุฑ ุงูุณุงุจู ููุชุงุจุนุฉ ุงูุญุฏูุซ ุญูู: {self.user_topic}ุ "

        return "ูู ููููู ุชูุถูุญ ุงุณุชูุณุงุฑู ุจุดูู ุฃูุจุฑ ุญุชู ุฃุชููู ูู ูุณุงุนุฏุชูุ"

    def ask_and_answer(self):
        topic_data = self.topics[self.user_topic]["follow_ups"]
        self.waiting_yes_no = True

        if self.depth < len(topic_data):
            question, answer = topic_data[self.depth]
            return f"{answer}\n\n๐ {question}"
        else:
            self.user_topic = None
            self.depth = 0
            self.waiting_yes_no = False
            return ("๐ ูุจุฏู ุฃู ุญุงูุชู ุชุญุชูู ุนูู ุชูุงุตูู ูุงููููุฉ ูุนูุฏุฉ.\n"
                    "ุฃูุตุญู ุจุงูุชูุงุตู ูุน ูุญุงูู ูุฎุชุต ููุณุงุนุฏุชู ุจุดูู ุฏููู.\n"
                    "๐จโโ๏ธ ููููู ุงูุงุชุตุงู ุจุงููุญุงูู ุนูู ุงูุฑูู: 079-123-4567")
